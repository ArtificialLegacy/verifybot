<!DOCTYPE html>
<html lang="en">

<%- include("blocks/head.ejs") %>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <a class="navbar-brand" href="/staff"><span class="fa fa-lock"></span> Staff Panel</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav-content" aria-controls="nav-content" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav-content">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/staff/support">Support Panel</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/staff/mod">Mod Panel</a>
                </li>
                <% if (perms.level >= 5) { %>
                    <li class="nav-item">
                        <a class="nav-link" href="/staff/admin">Admin Panel</a>
                    </li>
                <% } %>
            </ul>
        </div>
    </nav>

    <div class="container mt-3">
        <% if (mode === "success") { %>
            <h1 class="text-dark"><span class="fa fa-check-circle"></span> Success!</h1>
        <% } else if (mode === "error") { %>
            <h1 class="text-primary"><span class="fa fa-times-circle"></span> Something went wrong...</h1>
        <% } %>

        <h1>Recent Reports</h1>
        <ul class="nostyle">
            <li>
                <span class="text-muted">Please note that this does not show all reports, nor does it manage to correctly find the reason for them.</span>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th scope="col">Reporter</th>
                            <th scope="col">User</th>
                            <th scope="col">Offense</th>
                            <th scope="col">Attachment</th>
                        </tr>
                    </thead>
                    <tbody>
                        <%- data.reports.map(r => {
                            const report = /([a-zA-Z0-9]{2,16})[\s|](\||\-|:|is)[\s|](.+)/.exec(r.content).slice(1);
                            const attachment = r.attachments.first() ? r.attachments.first().url : r.embeds[0] && (r.embeds[0].image || r.embeds[0].video) ? r.embeds[0].image ? r.embeds[0].image.url : r.embeds[0].video.url : null;
                
                            return `
                            <tr>
                                <td>${r.author.tag}</td>
                                <td>${report[0]}</td>
                                <td>${report[2]}</td>
                                <td>${attachment ? `<a href="${attachment}" target="blank" class="btn btn-success" data-toggle="tooltip" title="Only downloaded if the attachment is a file.">View/Download</a>` : "No image found."}</td>
                            </tr>
                            `;
                        }).join("\n") %>
                    </tbody>
                </table>
            </li>
        </ul>

        <h1>Server Stats</h1>
        <ul>
            <li>There are currently <b><%= data.stats.players.online %></b>/<b><%= data.stats.players.max %></b> players online. (<%= Math.round((data.stats.players.online / data.stats.players.max) * 100) %>% capacity)</li>
            <li>The current MOTD is:<br><kbd><%- data.stats.motd.html.join("</kbd> <br /> <kbd>") %></kbd></li>
            <li>Server running on the IP <kbd><%= data.stats.ip %></kbd> on port <b><%= data.stats.port %></b>.</li>
        </ul>
    </div>

    <%- include("../blocks/footer.ejs") %>
</body>

</html>